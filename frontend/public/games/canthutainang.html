<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Game C√¢u C√° Theo S·ªë</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      background: linear-gradient(to bottom, #1a2980, #26d0ce);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      overflow: hidden;
      font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
      color: #fff;
      touch-action: manipulation;
      padding: 20px;
    }
    h1 {
      margin-bottom: 15px;
      text-align: center;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      font-size: 2.2rem;
      color: #FFD700;
    }
    #gameContainer {
      position: relative;
      margin-bottom: 20px;
    }
    canvas {
      background: transparent;
      border: 5px solid #2c3e50;
      border-radius: 10px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
    }
    #guide {
      position: absolute;
      top: 35px;
      width: 100%;
      text-align: right;
      font-size: 16px;
      text-shadow: 1px 1px 2px #000;
      padding: 0 10px;
    }
    #message {
      position: absolute;
      top: 40px;
      width: 100%;
      text-align: center;
      font-size: 20px;
      color: yellow;
      text-shadow: 1px 1px 2px #000;
      font-weight: bold;
    }
    #score {
      position: absolute;
      top: 0px;
      width: 100%;
      text-align: right;
      font-size: 18px;
      color: #fff;
      text-shadow: 1px 1px 2px #000;
    }
    #target {
      position: absolute;
      top: 100px;
      width: 100%;
      text-align: center;
      font-size: 18px;
      color: #FFD700;
      text-shadow: 1px 1px 2px #000;
      font-weight: bold;
    }
    #level {
      position: absolute;
      top: 0px;

      width: 100%;
      text-align: left;
      font-size: 18px;
      color: #FF6B6B;
      text-shadow: 1px 1px 2px #000;
      font-weight: bold;
    }
    #timer {
      position: absolute;
      top: 30px;
      width: 100%;
      text-align: left;
      font-size: 18px;
      color: #fff;
      text-shadow: 1px 1px 2px #000;
    }
    #controller {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    .control-btn {
      width: 70px;
      height: 70px;
      background-color: rgba(255, 255, 255, 0.3);
      border: 3px solid #fff;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 30px;
      color: white;
      cursor: pointer;
      user-select: none;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      transition: all 0.1s;
    }
    .control-btn:active {
      background-color: rgba(255, 255, 255, 0.5);
      transform: scale(0.95);
    }
    #drop-btn {
      background-color: rgba(231, 76, 60, 0.7);
    }
    #restart-btn, #next-level-btn {
      margin-top: 20px;
      padding: 12px 25px;
      background: linear-gradient(to bottom, #27ae60, #219653);
      color: white;
      border: none;
      border-radius: 50px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      transition: all 0.2s;
      display: none;
    }
    #next-level-btn {
      background: linear-gradient(to bottom, #3498db, #2980b9);
      margin-left: 10px;
    }
    #restart-btn:active, #next-level-btn:active {
      transform: scale(0.95);
    }
    #instructions {
      background: rgba(0, 0, 0, 0.6);
      padding: 15px;
      border-radius: 10px;
      margin-top: 20px;
      max-width: 500px;
      text-align: center;
    }
    .button-container {
      display: flex;
      justify-content: center;
      gap: 10px;
    }
    #result-box {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.85);
      padding: 30px;
      border-radius: 15px;
      text-align: center;
      z-index: 100;
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.7);
      border: 2px solid gold;
      max-width: 90%;
    }
    #result-box.hidden {
      display: none;
    }
    #result-box h2 {
      color: gold;
      margin-bottom: 15px;
      font-size: 24px;
    }
    #result-box p {
      margin: 10px 0;
      font-size: 18px;
    }
    #result-box button {
      margin-top: 15px;
      padding: 10px 20px;
      background: linear-gradient(to bottom, #3498db, #2980b9);
      color: white;
      border: none;
      border-radius: 50px;
      font-size: 16px;
      cursor: pointer;
    }
    @media (max-width: 500px) {
      canvas {
        width: 100%;
        height: auto;
      }
      h1 {
        font-size: 1.8rem;
      }
      .control-btn {
        width: 60px;
        height: 60px;
      }
      .button-container {
        flex-direction: column;
        align-items: center;
      }
      #restart-btn, #next-level-btn {
        margin-left: 0;
      }
      #result-box {
        padding: 20px;
      }
      #result-box h2 {
        font-size: 20px;
      }
      #result-box p {
        font-size: 16px;
      }
    }
  </style>
</head>
<body>
  <h1>Game C√¢u C√° Theo S·ªë</h1>
  <div id="gameContainer">
    <div id="guide">‚Üê ‚Üí ƒë·ªÉ di chuy·ªÉn | Space ho·∫∑c ‚Üì ƒë·ªÉ th·∫£ c·∫ßn</div>
    <div id="message"></div>
    <div id="score">ƒêi·ªÉm: 0</div>
    <div id="level">C·∫•p ƒë·ªô: 1 (S·ªë 1-10)</div>
    <div id="timer">Th·ªùi gian: 0s</div>
   
    <canvas id="gameCanvas" width="800" height="400"></canvas>
  </div>
  
  <div id="controller">
    <div class="control-btn" id="left-btn">‚Üê</div>
    <div class="control-btn" id="drop-btn">‚Üì</div>
    <div class="control-btn" id="right-btn">‚Üí</div>
  </div>

  <div class="button-container">
    <button id="restart-btn">Ch∆°i L·∫°i</button>
    <button id="next-level-btn">C·∫•p ƒê·ªô Ti·∫øp Theo</button>
  </div>

  <div id="instructions">
    <p><strong>Lu·∫≠t ch∆°i:</strong> B·∫°n ph·∫£i c√¢u c√° theo th·ª© t·ª± t·ª´ 1 ƒë·∫øn 40 qua 4 c·∫•p ƒë·ªô.<br>
    N·∫øu c√¢u sai s·ªë, b·∫°n s·∫Ω thua!</p>
  </div>

  <div id="result-box" class="hidden">
    <h2>K·∫øt qu·∫£</h2>
    <p id="result-text"></p>
    <button id="close-result">ƒê√≥ng</button>
  </div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const messageBox = document.getElementById("message");
    const scoreElement = document.getElementById("score");
    const targetElement = document.getElementById("target");
    const levelElement = document.getElementById("level");
    const timerElement = document.getElementById("timer");
    const leftBtn = document.getElementById("left-btn");
    const rightBtn = document.getElementById("right-btn");
    const dropBtn = document.getElementById("drop-btn");
    const restartBtn = document.getElementById("restart-btn");
    const nextLevelBtn = document.getElementById("next-level-btn");
    const resultBox = document.getElementById("result-box");
    const resultText = document.getElementById("result-text");
    const closeResultBtn = document.getElementById("close-result");

    // C√°c bi·∫øn tr√≤ ch∆°i
    let clawX = 250;
    let clawWidth = 40;
    let clawHeight = 20;
    let clawMove = 5;
    let ropeLength = 50;
    let isDropping = false;
    let isReturning = false;
    let score = 0;
    let currentTarget = 1;
    let gameOver = false;
    let currentLevel = 1;
    let totalLevels = 4;
    let maxTarget = 10; // M·ªói c·∫•p ƒë·ªô c√≥ 10 s·ªë
    let moveLeftActive = false;
    let moveRightActive = false;


    // Bi·∫øn th·ªùi gian
    let startTime = null;
    let timerInterval = null;
    let elapsedTime = 0;

    // X√°c ƒë·ªãnh ranh gi·ªõi n∆∞·ªõc
    const waterLevel = 100;
    let waveOffset = 0;

    // H√¨nh ·∫£nh
    const backgroundImg = new Image();
    backgroundImg.src = 'backgroundcauca.png';
    
    const boatImg = new Image();
    boatImg.src = 'boat.png';
    
    const fishermanImg = new Image();
    fishermanImg.src = 'nguoicauca.png';
    
    const hookImg = new Image();
    hookImg.src = 'moccau.png';
    
    const fishImg = new Image();
    fishImg.src = 'fish.png';

    // H√†m b·∫Øt ƒë·∫ßu ƒë·∫øm th·ªùi gian
    function startTimer() {
      startTime = performance.now();
      timerInterval = setInterval(() => {
        elapsedTime = (performance.now() - startTime) / 1000;
        timerElement.innerText = "Th·ªùi gian: " + elapsedTime.toFixed(1) + "s";
      }, 100);
    }

    // H√†m d·ª´ng ƒë·∫øm th·ªùi gian
    function stopTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
    }

    // H√†m k·∫øt th√∫c game
    function endGame(isWin) {
      stopTimer();
      gameOver = true;
      
      resultBox.classList.remove('hidden');
      
      if (isWin) {
        resultText.innerHTML = `üéâ Ho√†n th√†nh! ƒêi·ªÉm: <span style="color:gold">${score}</span> ‚Äî Th·ªùi gian: <strong>${elapsedTime.toFixed(2)}s</strong>`;
      } else {
        resultText.innerHTML = `üí• Game Over! ƒêi·ªÉm: <span style="color:gold">${score}</span> ‚Äî Th·ªùi gian: <strong>${elapsedTime.toFixed(2)}s</strong>`;
      }

      // üü¢ G·ª¨I ƒêI·ªÇM L√äN SERVER
      const username = localStorage.getItem('username') || prompt("Nh·∫≠p t√™n ng∆∞·ªùi ch∆°i c·ªßa b·∫°n:");
      if (username) {
        localStorage.setItem('username', username); // l∆∞u ƒë·ªÉ l·∫ßn sau kh·ªèi h·ªèi l·∫°i
        fetch("http://210.245.52.119/api_gamedemso/api/scores/save", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            username: username,
            gameId: 10,          // id game trong b·∫£ng games, t√πy b·∫°n ƒë·∫∑t
            score: score,
            timeTaken: elapsedTime
          })
        })
        .then(res => res.json())
        .then(data => {
          console.log("K·∫øt qu·∫£ l∆∞u ƒëi·ªÉm:", data);
          if (data.success) {
            resultText.innerHTML += "<br><span style='color:#10b981'>‚úÖ ƒêi·ªÉm ƒë√£ ƒë∆∞·ª£c l∆∞u!</span>";
          } else {
            resultText.innerHTML += "<br><span style='color:#ef4444'>‚ùå L∆∞u ƒëi·ªÉm th·∫•t b·∫°i: " + data.message + "</span>";
          }
        })
        .catch(err => {
          console.error("L·ªói l∆∞u ƒëi·ªÉm:", err);
          resultText.innerHTML += "<br><span style='color:#ef4444'>‚ö†Ô∏è Kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c server.</span>";
        });
      } else {
        resultText.innerHTML += "<br><span style='color:#facc15'>‚ö†Ô∏è Kh√¥ng l∆∞u ƒëi·ªÉm (ch∆∞a nh·∫≠p t√™n).</span>";
      }
    }

    // M√†u s·∫Øc cho c√° t·ª´ 1 ƒë·∫øn 40
    const fishColors = ["#ff5252", "#ffeb3b", "#2196f3", "#9c27b0", "#4caf50", 
                       "#ff9800", "#00bcd4", "#e91e63", "#8bc34a", "#673ab7",
                       "#f44336", "#cddc39", "#03a9f4", "#673ab7", "#4caf50",
                       "#ff5722", "#009688", "#e91e63", "#ffc107", "#3f51b5",
                       "#795548", "#9e9e9e", "#607d8b", "#ff4081", "#7c4dff",
                       "#00bcd4", "#ffeb3b", "#76ff03", "#ff9100", "#d500f9",
                       "#ff1744", "#3d5afe", "#ffea00", "#1de9b6", "#ff3d00",
                       "#651fff", "#f50057", "#2979ff", "#00e676", "#ffab00"];

    let fishes = [];

    // Kh·ªüi t·∫°o c√° cho c·∫•p ƒë·ªô hi·ªán t·∫°i
    function initFishes() {
      fishes = [];
      const startNumber = (currentLevel - 1) * 10 + 1;
      const endNumber = currentLevel * 10;
      
      for (let i = startNumber; i <= endNumber; i++) {
        fishes.push({
          x: Math.random() * (canvas.width - 80) + 40,
          y: waterLevel + 20 + Math.random() * (canvas.height - waterLevel - 70),
          vx: (Math.random() - 0.5) * (2 + (currentLevel - 1) * 0.5), // TƒÉng t·ªëc ƒë·ªô theo c·∫•p ƒë·ªô
          vy: (Math.random() - 0.5) * (1.5 + (currentLevel - 1) * 0.3),
          size: 30 - (currentLevel - 1) * 2, // Gi·∫£m k√≠ch th∆∞·ªõc theo c·∫•p ƒë·ªô
          num: i,
          color: fishColors[i-1],
          caught: false,
          direction: Math.random() > 0.5 ? 1 : -1
        });
      }
    }

    let caughtFish = null;

    // V·∫Ω thuy·ªÅn c√¢u c√° v·ªõi nh√¢n v·∫≠t
    function drawBoat() {
      const boatX = clawX - 40;
      const boatY = waterLevel - 35;
      
      // V·∫Ω thuy·ªÅn
      if (boatImg.complete) {
        ctx.drawImage(boatImg, boatX - 40, boatY - 20, 120, 60);
      }
      
      // V·∫Ω nh√¢n v·∫≠t c√¢u c√°
      if (fishermanImg.complete) {
        ctx.drawImage(fishermanImg, boatX + 40, boatY - 15, 40, 40);
      }
      
      // C·∫ßn c√¢u
      ctx.strokeStyle = "#8B4513";
      ctx.lineWidth = 3;
      ctx.lineCap = "round";
      ctx.beginPath();
      ctx.moveTo(boatX + 60, boatY + 5);
      ctx.lineTo(clawX+35, waterLevel - 50);
      ctx.stroke();
    }

    // V·∫Ω m√≥c c√¢u
    function drawClaw() {
      // V·∫Ω d√¢y c√¢u
      ctx.strokeStyle = "#bebebe";
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(clawX+35, waterLevel  -50);
      ctx.lineTo(clawX+35, ropeLength);
      ctx.stroke();
      
      // V·∫Ω m√≥c c√¢u
      if (hookImg.complete) {
        ctx.drawImage(hookImg, clawX +30, ropeLength - 5, 20, 20);
      }
    }

    // V·∫Ω c√°
    function drawFishes() {
      fishes.forEach(fish => {
        if (!fish.caught) {
          // V·∫Ω h√¨nh ·∫£nh c√°
          if (fishImg.complete) {
            ctx.save();
            
            // L·∫≠t h√¨nh c√° theo h∆∞·ªõng di chuy·ªÉn
            if (fish.direction < 0) {
              ctx.translate(fish.x, fish.y);
              ctx.scale(-1, 1);
              ctx.drawImage(fishImg, -fish.size, -fish.size/2, fish.size * 2, fish.size);
              ctx.restore();
            } else {
              ctx.drawImage(fishImg, fish.x - fish.size, fish.y - fish.size/2, fish.size * 2, fish.size);
            }
            
            // V·∫Ω s·ªë tr√™n c√° v·ªõi vi·ªÅn
            ctx.strokeStyle = "black";
            ctx.lineWidth = 3;
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.font = "bold " + (fish.size / 2.5) + "px Arial";
            ctx.strokeText(fish.num, fish.x, fish.y);
            
            ctx.fillStyle = "white";
            ctx.fillText(fish.num, fish.x, fish.y);
          }
        }
      });
    }

    // C·∫≠p nh·∫≠t v·ªã tr√≠ c√°
    function updateFishes() {
      fishes.forEach(fish => {
        if (!fish.caught && !gameOver) {
          fish.x += fish.vx;
          fish.y += fish.vy;

          if (fish.vx > 0) fish.direction = 1;
          else if (fish.vx < 0) fish.direction = -1;

          if (fish.x < fish.size / 2) {
            fish.x = fish.size / 2;
            fish.vx *= -1;
          } else if (fish.x > canvas.width - fish.size / 2) {
            fish.x = canvas.width - fish.size / 2;
            fish.vx *= -1;
          }
          
          if (fish.y < waterLevel + 10) {
            fish.y = waterLevel + 10;
            fish.vy *= -1;
          } else if (fish.y > canvas.height - fish.size / 2) {
            fish.y = canvas.height - fish.size / 2;
            fish.vy *= -1;
          }

          fishes.forEach(other => {
            if (fish !== other && !other.caught) {
              let dx = fish.x - other.x;
              let dy = fish.y - other.y;
              let dist = Math.sqrt(dx * dx + dy * dy);
              if (dist < fish.size) {
                let angle = Math.atan2(dy, dx);
                let overlap = fish.size - dist;
                fish.x += Math.cos(angle) * (overlap / 2);
                fish.y += Math.sin(angle) * (overlap / 2);
                other.x -= Math.cos(angle) * (overlap / 2);
                other.y -= Math.sin(angle) * (overlap / 2);
                
                let tempVx = fish.vx;
                let tempVy = fish.vy;
                fish.vx = other.vx;
                fish.vy = other.vy;
                other.vx = tempVx;
                other.vy = tempVy;
              }
            }
          });
        }
      });
    }

    // C·∫≠p nh·∫≠t c·∫ßn c√¢u (ƒëi·ªÅu ch·ªânh v·ªã tr√≠ m√≥c)
    function updateClaw() {
      if (isDropping && !gameOver) {
        ropeLength += 5;
        let clawTipX = clawX+30;
        let clawTipY = ropeLength + 5; // ƒêi·ªÅu ch·ªânh v·ªã tr√≠ m√≥c

        if (ropeLength > canvas.height - 50) {
          isDropping = false;
          isReturning = true;
        }

        fishes.forEach(fish => {
          if (!fish.caught) {
            let dx = clawTipX - fish.x;
            let dy = clawTipY - fish.y;
            let distance = Math.sqrt(dx * dx + dy * dy);
            if (distance < fish.size / 2 + 5) {
              fish.caught = true;
              caughtFish = fish;
              isDropping = false;
              isReturning = true;
              
              if (fish.num === currentTarget) {
                score += 10;
                scoreElement.innerText = "ƒêi·ªÉm: " + score;
                currentTarget++;
                
                // Ki·ªÉm tra n·∫øu ƒë√£ ho√†n th√†nh c·∫•p ƒë·ªô hi·ªán t·∫°i
                if (currentTarget > currentLevel * 10) {
                  if (currentLevel < totalLevels) {
                    // Ho√†n th√†nh c·∫•p ƒë·ªô
                    gameOver = true;
                    messageBox.innerText = "Ch√∫c m·ª´ng! B·∫°n ƒë√£ ho√†n th√†nh c·∫•p ƒë·ªô " + currentLevel + "!";
                    nextLevelBtn.style.display = "block";
                    stopTimer();
                  } else {
                    // Ho√†n th√†nh to√†n b·ªô tr√≤ ch∆°i
                    endGame(true);
                  }
                } 
              } else {
                endGame(false);
              }
            }
          }
        });

      } else if (isReturning && !gameOver) {
        ropeLength -= 5;
        if (caughtFish) {
          caughtFish.x = clawX;
          caughtFish.y = ropeLength + 10 + caughtFish.size / 2; // ƒêi·ªÅu ch·ªânh v·ªã tr√≠ c√° b·ªã c√¢u
        }
        if (ropeLength <= waterLevel + 20) {
          isReturning = false;
          if (caughtFish) {
            messageBox.innerText = "B·∫°n ƒë√£ c√¢u ƒë∆∞·ª£c s·ªë " + caughtFish.num;
            setTimeout(() => {
              if (!gameOver) messageBox.innerText = "";
            }, 2000);
            caughtFish = null;
          }
        }
      }
    }




  function handleContinuousMovement() {
  if (gameOver) return;
  if (isDropping || isReturning) return; // kh√¥ng cho di chuy·ªÉn khi th·∫£/k√©o l√™n
  if (moveLeftActive) {
    clawX = Math.max(clawX - clawMove, clawWidth / 2);
  }
  if (moveRightActive) {
    clawX = Math.min(clawX + clawMove, canvas.width - clawWidth / 2);
  }
}


// --- keyboard: nh·∫•n gi·ªØ / nh·∫£ ---
document.addEventListener("keydown", (e) => {
  if (gameOver) return;
  if (e.key === "ArrowLeft") {
    moveLeftActive = true;
    e.preventDefault(); // tr√°nh trang cu·ªôn
  } else if (e.key === "ArrowRight") {
    moveRightActive = true;
    e.preventDefault();
  } else if ((e.key === " " || e.key === "ArrowDown") && !isDropping && !isReturning) {
    // space ho·∫∑c xu·ªëng th·∫£ m√≥c
    isDropping = true;
    moveLeftActive = moveRightActive = false;
  }
});

document.addEventListener("keyup", (e) => {
  if (e.key === "ArrowLeft") moveLeftActive = false;
  else if (e.key === "ArrowRight") moveRightActive = false;
});




    // V√≤ng l·∫∑p game
    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      handleContinuousMovement();


      
      // V·∫Ω n·ªÅn
      if (backgroundImg.complete) {
        ctx.drawImage(backgroundImg, 0, 0, canvas.width, canvas.height);
      } else {
        // Fallback n·∫øu ·∫£nh ch∆∞a t·∫£i xong
        const bgGradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
        bgGradient.addColorStop(0, "#1e3c72");
        bgGradient.addColorStop(0.5, "#2a5298");
        bgGradient.addColorStop(1, "#1e5799");
        ctx.fillStyle = bgGradient;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
      }
      
      drawBoat();
      drawFishes();
      drawClaw();
      if (!gameOver) {
        updateFishes();
        updateClaw();
      }
      requestAnimationFrame(gameLoop);
    }

    // --- pointer (mouse/touch) hold-to-move handlers ---
leftBtn.addEventListener("pointerdown", (e) => {
  e.preventDefault();
  if (gameOver) return;
  if (!isDropping && !isReturning) moveLeftActive = true;
});
leftBtn.addEventListener("pointerup", (e) => {
  e.preventDefault();
  moveLeftActive = false;
});
leftBtn.addEventListener("pointercancel", (e) => { moveLeftActive = false; });
leftBtn.addEventListener("pointerleave", (e) => { moveLeftActive = false; });

rightBtn.addEventListener("pointerdown", (e) => {
  e.preventDefault();
  if (gameOver) return;
  if (!isDropping && !isReturning) moveRightActive = true;
});
rightBtn.addEventListener("pointerup", (e) => {
  e.preventDefault();
  moveRightActive = false;
});
rightBtn.addEventListener("pointercancel", (e) => { moveRightActive = false; });
rightBtn.addEventListener("pointerleave", (e) => { moveRightActive = false; });


    // N√∫t ch∆°i l·∫°i
    restartBtn.addEventListener("click", restartGame);
    
    // N√∫t chuy·ªÉn c·∫•p ƒë·ªô
    nextLevelBtn.addEventListener("click", nextLevel);
    
    // N√∫t ƒë√≥ng k·∫øt qu·∫£
    closeResultBtn.addEventListener("click", () => {
      resultBox.classList.add("hidden");
    });
    
    function restartGame() {
      clawX = 250;
      ropeLength = waterLevel + 20;
      isDropping = false;
      isReturning = false;
      score = 0;
      currentLevel = 1;
      currentTarget = 1;
      gameOver = false;
      caughtFish = null;
      elapsedTime = 0;
      
      scoreElement.innerText = "ƒêi·ªÉm: 0";
      levelElement.innerText = "C·∫•p ƒë·ªô: 1 (S·ªë 1-10)";
      
      timerElement.innerText = "Th·ªùi gian: 0s";
      messageBox.innerText = "";
      restartBtn.style.display = "none";
      nextLevelBtn.style.display = "none";
      resultBox.classList.add("hidden");
      
      // T·∫°o l·∫°i c√°
      initFishes();
      
      // B·∫Øt ƒë·∫ßu ƒë·∫øm th·ªùi gian
      startTimer();
    }
    
    function nextLevel() {
      currentLevel++;
      currentTarget = (currentLevel - 1) * 10 + 1;
      gameOver = false;
      caughtFish = null;
      isDropping = false;
      isReturning = false;
      ropeLength = waterLevel + 20;
      
      // C·∫≠p nh·∫≠t th√¥ng tin c·∫•p ƒë·ªô
      let levelRange = "";
      if (currentLevel === 2) levelRange = "S·ªë 11-20";
      else if (currentLevel === 3) levelRange = "S·ªë 21-30";
      else if (currentLevel === 4) levelRange = "S·ªë 31-40";
      
      levelElement.innerText = "C·∫•p ƒë·ªô: " + currentLevel + " (" + levelRange + ")";
      
      messageBox.innerText = "";
      nextLevelBtn.style.display = "none";
      
      // T·∫°o c√° m·ªõi cho c·∫•p ƒë·ªô m·ªõi
      initFishes();
      
      // TƒÉng t·ªëc ƒë·ªô di chuy·ªÉn c·ªßa c·∫ßn c√¢u ·ªü c√°c c·∫•p ƒë·ªô cao h∆°n
      clawMove = 5 + (currentLevel - 1);
      
      // Ti·∫øp t·ª•c ƒë·∫øm th·ªùi gian
      startTimer();
    }

    // Kh·ªüi ƒë·ªông game
    initFishes();
    levelElement.innerText = "C·∫•p ƒë·ªô: 1 (S·ªë 1-10)";
    
    startTimer();
    gameLoop();
  </script>
</body>
</html>