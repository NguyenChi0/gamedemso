<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Game ƒê·∫øm S·ªë 1‚Üí10</title>
<style>
  :root{
    --bg:#0f1724;
    --card:#0b1220;
    --accent:#10b981;
    --muted:#94a3b8;
    --danger:#ef4444;
    --glass: rgba(255,255,255,0.03);
  }
  body{
    font-family: Inter, system-ui, Arial;
    background: linear-gradient(180deg,#071029 0%, #081a2b 100%);
    color:#e6eef8;
    margin:0;
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:24px;
  }
  .card{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:12px;
    padding:20px;
    width:420px;
    box-shadow: 0 8px 30px rgba(2,6,23,0.7);
    border: 1px solid rgba(255,255,255,0.04);
  }
  h1{
    margin:0 0 8px 0;
    font-size:20px;
  }
  .meta{
    display:flex;
    gap:10px;
    align-items:center;
    margin-bottom:12px;
  }
  .pill{
    background:var(--glass);
    padding:8px 10px;
    border-radius:10px;
    font-size:14px;
    color:var(--muted);
    min-width:90px;
    text-align:center;
  }
  .target{
    font-weight:700;
    color:var(--accent);
    font-size:18px;
  }
  .controls{
    display:flex;
    gap:8px;
    margin-bottom:14px;
  }
  button.btn{
    flex:1;
    padding:8px 10px;
    border-radius:10px;
    border:0;
    cursor:pointer;
    font-weight:600;
    background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    color:inherit;
    border:1px solid rgba(255,255,255,0.04);
  }
  button.btn:active{ transform: translateY(1px); }
  .grid{
    display:grid;
    grid-template-columns: repeat(5, 1fr);
    gap:8px;
  }
  .num-btn{
    background:transparent;
    border-radius:8px;
    padding:14px 8px;
    font-size:18px;
    font-weight:700;
    border:1px solid rgba(255,255,255,0.06);
    cursor:pointer;
    transition: all .12s ease;
    color: #dbeafe;
  }
  .num-btn:hover{ transform: translateY(-3px); box-shadow: 0 6px 18px rgba(2,6,23,0.6); }
  .num-btn.correct{
    background: linear-gradient(90deg, rgba(16,185,129,0.12), rgba(16,185,129,0.06));
    border-color: rgba(16,185,129,0.6);
    color: var(--accent);
    cursor: default;
  }
  .num-btn.wrong{
    animation:shake .35s;
    background: linear-gradient(90deg, rgba(239,68,68,0.08), rgba(239,68,68,0.04));
    border-color: rgba(239,68,68,0.6);
    color: var(--danger);
  }
  @keyframes shake {
    0%{ transform: translateX(0); }
    20%{ transform: translateX(-6px); }
    40%{ transform: translateX(6px); }
    60%{ transform: translateX(-4px); }
    80%{ transform: translateX(4px); }
    100%{ transform: translateX(0); }
  }
  .footer{
    margin-top:12px;
    font-size:13px;
    color:var(--muted);
    display:flex;
    justify-content:space-between;
    align-items:center;
  }
  .result{
    margin-top:12px;
    padding:10px;
    border-radius:8px;
    background: rgba(255,255,255,0.02);
    border:1px solid rgba(255,255,255,0.03);
    text-align:center;
    font-weight:700;
  }
  .hidden{ display:none; }
</style>
</head>
<body>
  <div class="card" role="application" aria-label="Game ƒë·∫øm s·ªë 1 ƒë·∫øn 10">
    <h1>Game: ƒê·∫øm s·ªë 1 ‚Üí 10</h1>
    <div class="meta">
      <div class="pill">M·ª•c ti√™u: <span id="target" class="target">1</span></div>
      <div class="pill">ƒêi·ªÉm: <span id="score">0</span></div>
      <div class="pill">Th·ªùi gian: <span id="time">0.00s</span></div>
    </div>

    <div class="controls">
      <button id="startBtn" class="btn">Start</button>
      <button id="resetBtn" class="btn">Reset</button>
    </div>

    <div class="grid" id="grid" aria-live="polite">
      <!-- c√°c n√∫t s·ªë s·∫Ω ƒë∆∞·ª£c render ·ªü ƒë√¢y -->
    </div>

    <div class="result hidden" id="resultBox" role="status" aria-atomic="true">
      <!-- k·∫øt qu·∫£ hi·ªán ra ·ªü ƒë√¢y -->
    </div>

    <div class="footer">
      <div>Nh·∫•n c√°c s·ªë theo th·ª© t·ª±. M·ªói l·∫ßn ƒë√∫ng +10 ƒëi·ªÉm.</div>
      <div style="opacity:.8">Simple version</div>
    </div>
  </div>

<script>
(function(){
  const gridEl = document.getElementById('grid');
  const targetEl = document.getElementById('target');
  const scoreEl = document.getElementById('score');
  const timeEl = document.getElementById('time');
  const startBtn = document.getElementById('startBtn');
  const resetBtn = document.getElementById('resetBtn');
  const resultBox = document.getElementById('resultBox');

  let numbers = [];
  let current = 1;
  let score = 0;
  let running = false;
  let startTime = null;
  let timerId = null;

  function shuffle(arr){
    for(let i = arr.length - 1; i > 0; i--){
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  function renderGrid(){
    gridEl.innerHTML = '';
    numbers.forEach(n => {
      const btn = document.createElement('button');
      btn.className = 'num-btn';
      btn.innerText = n;
      btn.setAttribute('data-n', n);
      btn.addEventListener('click', onNumberClick);
      btn.disabled = false;
      gridEl.appendChild(btn);
    });
  }

  function startTimer(){
    if (running) return;
    running = true;
    startTime = performance.now();
    timerId = setInterval(()=> {
      const elapsed = (performance.now() - startTime) / 1000;
      timeEl.innerText = elapsed.toFixed(2) + 's';
    }, 50);
  }

  function stopTimer(){
    running = false;
    if (timerId) {
      clearInterval(timerId);
      timerId = null;
    }
  }

  function resetGame(){
    stopTimer();
    numbers = shuffle([...Array(10)].map((_,i)=>i+1));
    current = 1;
    score = 0;
    startTime = null;
    timeEl.innerText = '0.00s';
    scoreEl.innerText = score;
    targetEl.innerText = current;
    resultBox.classList.add('hidden');
    renderGrid();
  }

  function endGame(){
  stopTimer();
  const elapsed = startTime ? (performance.now() - startTime)/1000 : 0;
  resultBox.classList.remove('hidden');
  resultBox.innerHTML = `üéâ Ho√†n th√†nh! ƒêi·ªÉm: ${score} ‚Äî Th·ªùi gian: ${elapsed.toFixed(2)}s`;

  // disable remaining buttons
  Array.from(gridEl.querySelectorAll('button')).forEach(b => b.disabled = true);

  // üöÄ g·ª≠i k·∫øt qu·∫£ ra ngo√†i cho GameViewer
  // trong endGame()
window.parent.postMessage({ score: score, time: elapsed.toFixed(2) }, "*");

// v√† g·ªçi API l∆∞u ƒëi·ªÉm
fetch('http://210.245.52.119/api_gamedemso/api/scores/save', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    gameId: 15,              // id game trong DB (theo dump b·∫°n g·ª≠i "ƒê·∫øm s·ªë" l√† id 15)
    username: localStorage.getItem('username') || 'guest', // ho·∫∑c l·∫•y t·ª´ form login
    score: score,
    time: Number(elapsed.toFixed(2))
  })
}).then(r => r.json())
  .then(data => {
    console.log('Saved result:', data);
    if (data.insertedPosition) {
      // show feedback
      resultBox.innerHTML += `<div style="margin-top:6px;color:#d1fae5">B·∫°n ƒë·∫°t Top ${data.insertedPosition}!</div>`;
    }
  })
  .catch(err => console.error('L·ªói l∆∞u ƒëi·ªÉm:', err));

}


  function onNumberClick(e){
    const btn = e.currentTarget;
    const n = Number(btn.getAttribute('data-n'));
    // n·∫øu ch∆∞a b·∫Øt ƒë·∫ßu, start timer on first click
    if (!running) startTimer();

    if (n === current){
      // ƒë√∫ng
      score += 10;
      scoreEl.innerText = score;
      btn.classList.add('correct');
      btn.disabled = true;
      current += 1;
      if (current <= 10){
        targetEl.innerText = current;
      } else {
        targetEl.innerText = '-';
        endGame();
      }
    } else {
      // sai -> feedback nh·∫π
      btn.classList.add('wrong');
      setTimeout(()=> btn.classList.remove('wrong'), 300);
      // kh√¥ng tr·ª´ ƒëi·ªÉm theo y√™u c·∫ßu; n·∫øu mu·ªën tr·ª´, ch·ªânh ·ªü ƒë√¢y
    }
  }

  // n√∫t Start
  startBtn.addEventListener('click', ()=> {
    // n·∫øu ƒë√£ ho√†n th√†nh, reset tr∆∞·ªõc
    if (current > 10) resetGame();
    startTimer();
  });

  // n√∫t Reset
  resetBtn.addEventListener('click', resetGame);

  // kh·ªüi t·∫°o l·∫ßn ƒë·∫ßu
  resetGame();

  // keyboard support: ph√≠m s·ªë 1..9,0(10)
  window.addEventListener('keydown', (ev)=>{
    const key = ev.key;
    let val = null;
    if (key >= '1' && key <= '9') val = Number(key);
    else if (key === '0') val = 10;
    if (val !== null){
      const btn = gridEl.querySelector('button[data-n="'+val+'"]');
      if (btn && !btn.disabled) btn.click();
    }
  });

})();
</script>
</body>
</html>
